srun: job 34138 queued and waiting for resources
srun: job 34138 has been allocated resources
Namespace(device='cuda', dataset='tissue', data_dir='./data', noise_type='symmetric', noise_rate=20, num_classes=8, batch_size=128, num_batches=10000, clustering='none', num_samples=165466, model='resnet18', pretrain=False, optimizer='sgd', momentum=0.9, lr=0.05, epochs=10, gamma=0.01, weight_decay=0.0)
Using downloaded and verified file: /u/home/tei/.medmnist/tissuemnist_128.npz
Actual Noise Rate:  0.19915873955978872
Using downloaded and verified file: /u/home/tei/.medmnist/tissuemnist_128.npz
Train set length:  165466
Test set length:  47280
Using ResNet18
Initializing  model resnet18
Using SGD. LR: 0.05, WD: 0.0, M: 0.9
Using CosineAnnealingLR. T_max 10, ETA: 0.0005
Current sieving threshold is 0.1
Start eval
/u/home/tei/.conda/envs/coenv/lib/python3.9/site-packages/torch/nn/modules/conv.py:456: UserWarning: Attempt to open cnn_infer failed: handle=0 error: libcudnn_cnn_infer.so.8: cannot open shared object file: No such file or directory (Triggered internally at ../aten/src/ATen/native/cudnn/Conv_v8.cpp:81.)
  return F.conv2d(input, weight, bias, self.stride,
End eval
/u/home/tei/Data/confes-reihaneh/main.py:140: UserWarning: you are shuffling a 'Tensor' object which is not a subclass of 'Sequence'; `shuffle` is not guaranteed to behave correctly. E.g., non-numpy array/tensor objects with view semantics may contain duplicates after shuffling.
  np.random.shuffle(clean_labels_epoch)
Clean Selection success: 118434/147577  80.25234284475223%
Noisy Selection success: 3811/17889  21.3035943876125%
Counts of filtered labels
Counter({6: 5039, 7: 3224, 2: 2882, 4: 2678, 0: 1724, 3: 1698, 5: 375, 1: 269})
Epoch : 0
Epoch # 0
Start train
End train
Training loss: 1.5475558034228614, Training accuracy: 0.4755236725369562 
Start test
Average test loss(weighted):  1.4384, test accuracy:  53.5491
Class-wise accuracies:
 [0.8498516082763672, 0.08329601585865021, 0.0, 0.5449795722961426, 0.11487088352441788, 0.09945504367351532, 0.6435139775276184, 0.2888635993003845, 0.5354906916618347]
Class-wise F1 scores:
 [0.666218638420105, 0.11048410832881927, 0.0, 0.48770076036453247, 0.1782178282737732, 0.13708920776844025, 0.6295746564865112, 0.38495072722435, 0.5354906916618347]
Class-wise AUCs:
 [0.8521221876144409, 0.7471694946289062, 0.4864561855792999, 0.879118800163269, 0.8251526355743408, 0.7661939263343811, 0.8587768077850342, 0.7936248779296875, 0.823662519454956]
End test
Current sieving threshold is 0.0
Start eval
End eval
/u/home/tei/Data/confes-reihaneh/main.py:140: UserWarning: you are shuffling a 'Tensor' object which is not a subclass of 'Sequence'; `shuffle` is not guaranteed to behave correctly. E.g., non-numpy array/tensor objects with view semantics may contain duplicates after shuffling.
  np.random.shuffle(clean_labels_epoch)
Clean Selection success: 71791/74094  96.89178610953654%
Noisy Selection success: 30651/91372  33.54528739657663%
Counts of filtered labels
Counter({6: 18633, 7: 18203, 0: 16113, 4: 10454, 3: 8433, 1: 6961, 5: 6881, 2: 5694})
Epoch : 1
Epoch # 1
Start train
End train
Training loss: 0.13241276827447077, Training accuracy: 0.9518209178924976 
Start test
Average test loss(weighted):  3.6999, test accuracy:  54.8033
Class-wise accuracies:
 [0.8456313610076904, 0.047917600721120834, 0.0, 0.5390731692314148, 0.1261501908302307, 0.07447774708271027, 0.6760110855102539, 0.34788793325424194, 0.5480329990386963]
Class-wise F1 scores:
 [0.6724874973297119, 0.07833089679479599, 0.0, 0.4899349510669708, 0.19313792884349823, 0.11221347749233246, 0.6405820250511169, 0.4306338131427765, 0.5480329990386963]
Class-wise AUCs:
 [0.8484770059585571, 0.6696434020996094, 0.6648985743522644, 0.8736187815666199, 0.8253118991851807, 0.7535403966903687, 0.8648744225502014, 0.8150997757911682, 0.8287091255187988]
End test
Current sieving threshold is 0.0
Start eval
End eval
/u/home/tei/Data/confes-reihaneh/main.py:140: UserWarning: you are shuffling a 'Tensor' object which is not a subclass of 'Sequence'; `shuffle` is not guaranteed to behave correctly. E.g., non-numpy array/tensor objects with view semantics may contain duplicates after shuffling.
  np.random.shuffle(clean_labels_epoch)
Clean Selection success: 74121/76460  96.94088412241695%
Noisy Selection success: 30615/89006  34.396557535447045%
Counts of filtered labels
Counter({6: 17473, 7: 16992, 0: 16072, 4: 10229, 3: 8389, 1: 7159, 5: 6993, 2: 5699})
Epoch : 2
Epoch # 2
Start train
End train
Training loss: 0.07981037244896497, Training accuracy: 0.9703806220008945 
Start test
Average test loss(weighted):  4.1884, test accuracy:  55.8249
Class-wise accuracies:
 [0.8594790697097778, 0.07702641934156418, 0.0, 0.5204452276229858, 0.20985455811023712, 0.07538601011037827, 0.6731541752815247, 0.3532925546169281, 0.55824875831604]
Class-wise F1 scores:
 [0.6789602637290955, 0.11661016941070557, 0.0, 0.5109277367591858, 0.27435001730918884, 0.11499826610088348, 0.6502522826194763, 0.4381338655948639, 0.55824875831604]
Class-wise AUCs:
 [0.8562710285186768, 0.6618163585662842, 0.7225918769836426, 0.8736557960510254, 0.8328671455383301, 0.7483140230178833, 0.8690085411071777, 0.8210616111755371, 0.835050106048584]
End test
Current sieving threshold is 0.0
Start eval
End eval
/u/home/tei/Data/confes-reihaneh/main.py:140: UserWarning: you are shuffling a 'Tensor' object which is not a subclass of 'Sequence'; `shuffle` is not guaranteed to behave correctly. E.g., non-numpy array/tensor objects with view semantics may contain duplicates after shuffling.
  np.random.shuffle(clean_labels_epoch)
Clean Selection success: 76425/78778  97.0131254918886%
Noisy Selection success: 30601/86688  35.30015688445921%
Counts of filtered labels
Counter({6: 17228, 7: 16655, 0: 15369, 4: 9424, 3: 8346, 5: 6996, 1: 6979, 2: 5691})
Epoch : 3
Epoch # 3
Start train
End train
Training loss: 0.06537743405153008, Training accuracy: 0.9762005487532182 
Start test
Average test loss(weighted):  4.5192, test accuracy:  57.4133
Class-wise accuracies:
 [0.8613254427909851, 0.054187193512916565, 0.0, 0.5931394696235657, 0.27278125286102295, 0.08401453495025635, 0.7149361371994019, 0.3184468746185303, 0.5741328001022339]
Class-wise F1 scores:
 [0.6880349516868591, 0.0941634252667427, 0.0, 0.5398532152175903, 0.3229660987854004, 0.13041946291923523, 0.6800849437713623, 0.42273199558258057, 0.5741328001022339]
Class-wise AUCs:
 [0.8632791042327881, 0.6703715324401855, 0.7429859638214111, 0.8902966380119324, 0.8488059639930725, 0.784684956073761, 0.8843662142753601, 0.8295614719390869, 0.8477067947387695]
End test
Current sieving threshold is 0.0
Start eval
End eval
/u/home/tei/Data/confes-reihaneh/main.py:140: UserWarning: you are shuffling a 'Tensor' object which is not a subclass of 'Sequence'; `shuffle` is not guaranteed to behave correctly. E.g., non-numpy array/tensor objects with view semantics may contain duplicates after shuffling.
  np.random.shuffle(clean_labels_epoch)
Clean Selection success: 79312/81679  97.10207029958741%
Noisy Selection success: 30587/83787  36.505663169704135%
Counts of filtered labels
Counter({7: 16909, 6: 15930, 0: 15026, 4: 8739, 3: 7597, 1: 7036, 5: 6883, 2: 5667})
Epoch : 4
Epoch # 4
Start train
End train
Training loss: 0.05366202075216611, Training accuracy: 0.980231588362564 
Start test
Average test loss(weighted):  4.7515, test accuracy:  57.8744
Class-wise accuracies:
 [0.8693042993545532, 0.023287057876586914, 0.0, 0.7099046111106873, 0.2674384117126465, 0.10490462929010391, 0.7081510424613953, 0.2757786810398102, 0.5787436366081238]
Class-wise F1 scores:
 [0.7073752880096436, 0.044635191559791565, 0.0, 0.5292573571205139, 0.327160507440567, 0.16165150701999664, 0.6850332617759705, 0.38986629247665405, 0.5787436366081238]
Class-wise AUCs:
 [0.8782968521118164, 0.65456223487854, 0.6861907243728638, 0.902003288269043, 0.8444335460662842, 0.8142529129981995, 0.8892955183982849, 0.8309617042541504, 0.8532940149307251]
End test
Current sieving threshold is 0.0
Start eval
End eval
/u/home/tei/Data/confes-reihaneh/main.py:140: UserWarning: you are shuffling a 'Tensor' object which is not a subclass of 'Sequence'; `shuffle` is not guaranteed to behave correctly. E.g., non-numpy array/tensor objects with view semantics may contain duplicates after shuffling.
  np.random.shuffle(clean_labels_epoch)
Clean Selection success: 80733/83196  97.0395211308236%
Noisy Selection success: 30491/82270  37.062112556217336%
Counts of filtered labels
Counter({7: 17477, 6: 15818, 0: 14648, 4: 8564, 1: 7175, 5: 6699, 3: 6233, 2: 5656})
Epoch : 5
Epoch # 5
Start train
End train
Training loss: 0.045111996436827256, Training accuracy: 0.9838516674120363 
Start test
Average test loss(weighted):  4.8163, test accuracy:  58.5131
Class-wise accuracies:
 [0.8786020278930664, 0.03493058681488037, 0.0, 0.6628804802894592, 0.24487978219985962, 0.07811080664396286, 0.7075260877609253, 0.34461671113967896, 0.5851311087608337]
Class-wise F1 scores:
 [0.6989272832870483, 0.06562894582748413, 0.0, 0.5436422824859619, 0.31682026386260986, 0.13119755685329437, 0.6904513239860535, 0.44630688428878784, 0.5851311087608337]
Class-wise AUCs:
 [0.874143123626709, 0.6604048013687134, 0.7491090297698975, 0.9017283916473389, 0.8455593585968018, 0.8197546601295471, 0.8913061618804932, 0.8362523913383484, 0.8560433387756348]
End test
Current sieving threshold is 0.0
Start eval
End eval
/u/home/tei/Data/confes-reihaneh/main.py:140: UserWarning: you are shuffling a 'Tensor' object which is not a subclass of 'Sequence'; `shuffle` is not guaranteed to behave correctly. E.g., non-numpy array/tensor objects with view semantics may contain duplicates after shuffling.
  np.random.shuffle(clean_labels_epoch)
Clean Selection success: 82737/85224  97.08180794142494%
Noisy Selection success: 30467/80242  37.968894095361534%
Counts of filtered labels
Counter({7: 16215, 6: 15306, 0: 14117, 4: 8593, 1: 7082, 5: 6780, 3: 6487, 2: 5662})
Epoch : 6
Epoch # 6
Start train
End train
Training loss: 0.03085651451767525, Training accuracy: 0.9885535396999988 
Start test
Average test loss(weighted):  4.7543, test accuracy:  59.9492
Class-wise accuracies:
 [0.8623805046081543, 0.04299149289727211, 0.0, 0.6608359813690186, 0.2908875048160553, 0.09445958584547043, 0.7052049040794373, 0.4514293968677521, 0.5994923710823059]
Class-wise F1 scores:
 [0.7106450200080872, 0.079044871032238, 0.0, 0.557493269443512, 0.35487958788871765, 0.15361890196800232, 0.69859379529953, 0.5133015513420105, 0.5994923710823059]
Class-wise AUCs:
 [0.8774000406265259, 0.6937365531921387, 0.7487550973892212, 0.90946364402771, 0.855818510055542, 0.8276234865188599, 0.8937754034996033, 0.8466500043869019, 0.8625985383987427]
End test
Current sieving threshold is 0.0
Start eval
End eval
/u/home/tei/Data/confes-reihaneh/main.py:140: UserWarning: you are shuffling a 'Tensor' object which is not a subclass of 'Sequence'; `shuffle` is not guaranteed to behave correctly. E.g., non-numpy array/tensor objects with view semantics may contain duplicates after shuffling.
  np.random.shuffle(clean_labels_epoch)
Clean Selection success: 85335/87898  97.0841202302669%
Noisy Selection success: 30391/77568  39.179816419141915%
Counts of filtered labels
Counter({6: 14972, 7: 14513, 0: 14179, 4: 8214, 1: 7000, 5: 6670, 3: 6370, 2: 5650})
Epoch : 7
Epoch # 7
Start train
End train
Training loss: 0.02526109336099457, Training accuracy: 0.9908803016933992 
Start test
Average test loss(weighted):  4.7228, test accuracy:  60.9687
Class-wise accuracies:
 [0.855390727519989, 0.042095836251974106, 0.0, 0.7026351690292358, 0.31403976678848267, 0.18346957862377167, 0.7072582840919495, 0.46693214774131775, 0.6096869707107544]
Class-wise F1 scores:
 [0.7284980416297913, 0.07830070704221725, 0.0, 0.5699281096458435, 0.3716845214366913, 0.2551310360431671, 0.6975740790367126, 0.5277286767959595, 0.6096869707107544]
Class-wise AUCs:
 [0.8876882791519165, 0.7034080028533936, 0.716780424118042, 0.9179540872573853, 0.8490545749664307, 0.8485068082809448, 0.8972830772399902, 0.8572872281074524, 0.8689151406288147]
End test
Current sieving threshold is 0.0
Start eval
End eval
/u/home/tei/Data/confes-reihaneh/main.py:140: UserWarning: you are shuffling a 'Tensor' object which is not a subclass of 'Sequence'; `shuffle` is not guaranteed to behave correctly. E.g., non-numpy array/tensor objects with view semantics may contain duplicates after shuffling.
  np.random.shuffle(clean_labels_epoch)
Clean Selection success: 87268/89899  97.07338235130536%
Noisy Selection success: 30323/75567  40.12730424656265%
Counts of filtered labels
Counter({6: 14726, 0: 14153, 7: 13998, 4: 7916, 1: 6971, 5: 6189, 3: 5979, 2: 5635})
Epoch : 8
Epoch # 8
Start train
End train
Training loss: 0.02083757303012117, Training accuracy: 0.9926027099222801 
Start test
Average test loss(weighted):  4.7654, test accuracy:  61.4763
Class-wise accuracies:
 [0.8522255420684814, 0.05776981636881828, 0.0, 0.7010449767112732, 0.3345206379890442, 0.20526793599128723, 0.711097240447998, 0.4811548888683319, 0.6147631406784058]
Class-wise F1 scores:
 [0.7317818999290466, 0.1034482792019844, 0.0, 0.5754778385162354, 0.3894937038421631, 0.27806827425956726, 0.7010826468467712, 0.5377523303031921, 0.6147631406784058]
Class-wise AUCs:
 [0.8892401456832886, 0.7250676155090332, 0.693484902381897, 0.9197396636009216, 0.851302981376648, 0.854824960231781, 0.8998774290084839, 0.8604476451873779, 0.8713148832321167]
End test
Current sieving threshold is 0.0
Start eval
End eval
/u/home/tei/Data/confes-reihaneh/main.py:140: UserWarning: you are shuffling a 'Tensor' object which is not a subclass of 'Sequence'; `shuffle` is not guaranteed to behave correctly. E.g., non-numpy array/tensor objects with view semantics may contain duplicates after shuffling.
  np.random.shuffle(clean_labels_epoch)
Clean Selection success: 88305/90987  97.05232615648389%
Noisy Selection success: 30272/74479  40.64501403080063%
Counts of filtered labels
Counter({6: 14540, 0: 14100, 7: 13657, 4: 7703, 1: 6890, 5: 6050, 3: 5913, 2: 5626})
Epoch : 9
Epoch # 9
Start train
End train
Training loss: 0.017106495873308585, Training accuracy: 0.9941740297100311 
Start test
Average test loss(weighted):  4.7640, test accuracy:  61.8951
Class-wise accuracies:
 [0.8501154184341431, 0.05642633140087128, 0.0, 0.7217174172401428, 0.34164440631866455, 0.23251590132713318, 0.7179716229438782, 0.47845256328582764, 0.6189509034156799]
Class-wise F1 scores:
 [0.735781729221344, 0.10185933858156204, 0.0, 0.5798503160476685, 0.39662301540374756, 0.3005576729774475, 0.7066783905029297, 0.5409664511680603, 0.6189509034156799]
Class-wise AUCs:
 [0.8912935853004456, 0.7276270985603333, 0.6821065545082092, 0.9215970039367676, 0.8471774458885193, 0.859871506690979, 0.9025537371635437, 0.8631002902984619, 0.8728333711624146]
End test
